<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ìœ„ì¹˜ ê¶Œí•œ í™•ì¸</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #fefae0;
      text-align: center;
      padding: 2rem;
    }
    #status {
      margin-top: 2rem;
      font-size: 1.5rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>ìš°ë¬´ì‚¬ë¦¬ ìœ„ì¹˜ í™•ì¸</h1>
  <p>ë‹¹ì‹ ì˜ ìœ„ì¹˜ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸ ì¤‘ì´ì—ìš”.</p>
  <div id="status">â³ ìœ„ì¹˜ ì„œë¹„ìŠ¤ í™•ì¸ ì¤‘...</div>

  <script>
    const statusEl = document.getElementById("status");

    // ìœ„ì¹˜ ê¶Œí•œ í™•ì¸ í•¨ìˆ˜
    function checkGeolocationPermission() {
      if (!navigator.permissions || !navigator.geolocation) {
        statusEl.innerText = "âŒ ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›í•˜ì§€ ì•Šì•„ìš”.";
        return;
      }

      navigator.permissions.query({ name: "geolocation" }).then(function(result) {
        if (result.state === "granted") {
          statusEl.innerText = "âœ… ìœ„ì¹˜ ì„œë¹„ìŠ¤ê°€ ì´ë¯¸ í—ˆìš©ë˜ì–´ ìˆì–´ìš”!";
          getLocation(); // ìœ„ì¹˜ ì •ë³´ ë°›ì•„ì˜¤ê¸°
        } else if (result.state === "prompt") {
          statusEl.innerText = "â” ìœ„ì¹˜ ì„œë¹„ìŠ¤ ì‚¬ìš© í—ˆê°€ë¥¼ ìš”ì²­í•©ë‹ˆë‹¤.";
          requestLocation(); // ìœ„ì¹˜ ìš”ì²­í•˜ë©´ì„œ ë¬¼ì–´ë´„
        } else if (result.state === "denied") {
          statusEl.innerText = "ğŸš« ìœ„ì¹˜ ì„œë¹„ìŠ¤ ì‚¬ìš©ì´ ì°¨ë‹¨ë˜ì–´ ìˆì–´ìš”. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.";
        }

        // ê¶Œí•œ ìƒíƒœê°€ ë°”ë€” ë•Œë„ ê°ì§€
        result.onchange = () => {
          checkGeolocationPermission();
        };
      });
    }

    // ìœ„ì¹˜ ìš”ì²­ í•¨ìˆ˜
    function requestLocation() {
      navigator.geolocation.getCurrentPosition(
        function (position) {
          const lat = position.coords.latitude.toFixed(5);
          const lon = position.coords.longitude.toFixed(5);
          statusEl.innerText = `ğŸ“ ìœ„ì¹˜ í—ˆìš©ë¨! ìœ„ë„: ${lat}, ê²½ë„: ${lon}`;
        },
        function (error) {
          if (error.code === error.PERMISSION_DENIED) {
            statusEl.innerText = "ğŸ™… ìœ„ì¹˜ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆì–´ìš”.";
          } else if (error.code === error.POSITION_UNAVAILABLE) {
            statusEl.innerText = "ğŸ“¡ ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ì–´ìš”.";
          } else if (error.code === error.TIMEOUT) {
            statusEl.innerText = "â±ï¸ ìœ„ì¹˜ ìš”ì²­ì´ ì‹œê°„ ì´ˆê³¼ë˜ì—ˆì–´ìš”.";
          } else {
            statusEl.innerText = "âš ï¸ ìœ„ì¹˜ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”.";
          }
        }
      );
    }

    // ê¶Œí•œì´ í—ˆìš©ëœ ê²½ìš° ìœ„ì¹˜ë¥¼ ë¶ˆëŸ¬ì˜´
    function getLocation() {
      navigator.geolocation.getCurrentPosition(function (position) {
        const lat = position.coords.latitude.toFixed(5);
        const lon = position.coords.longitude.toFixed(5);
        statusEl.innerText = `ğŸ“ í˜„ì¬ ìœ„ì¹˜: ìœ„ë„ ${lat}, ê²½ë„ ${lon}`;
      });
    }

    // í˜ì´ì§€ ë¡œë“œì‹œ ìë™ ì‹¤í–‰
    checkGeolocationPermission();
  </script>
</body>
</html>
