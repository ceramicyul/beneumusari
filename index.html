<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>우무사리 위치 기반 감정 시작</title>
  <style>
    body {
      font-family: 'sans-serif';
      text-align: center;
      background-color: #fffaf2;
      padding: 2rem;
    }

    #status {
      margin: 2rem 0;
      font-size: 1.3rem;
    }

    #startBtn {
      display: none;
      font-size: 1.4rem;
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 10px;
      background-color: #ffcab0;
      color: #333;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    #startBtn:hover {
      background-color: #ffb89c;
    }
  </style>
</head>
<body>
  <h1>우무사리가 당신의 위치를 확인하고 있어요</h1>
  <div id="status">⏳ 위치 정보 불러오는 중...</div>
  <button id="startBtn">내 감정 알아보기</button>

  <script>
    const statusEl = document.getElementById("status");
    const startBtn = document.getElementById("startBtn");

    function checkGeolocationPermission() {
      if (!navigator.permissions || !navigator.geolocation) {
        statusEl.innerText = "❌ 이 브라우저는 위치 서비스를 지원하지 않아요.";
        return;
      }

      navigator.permissions.query({ name: "geolocation" }).then(function(result) {
        if (result.state === "granted") {
          statusEl.innerText = "✅ 위치 서비스 허용됨!";
          getLocation();
        } else if (result.state === "prompt") {
          statusEl.innerText = "❔ 위치 서비스 요청 중...";
          requestLocation();
        } else if (result.state === "denied") {
          statusEl.innerText = "🚫 위치 서비스가 차단되어 있어요.";
        }

        result.onchange = () => checkGeolocationPermission();
      });
    }

    function requestLocation() {
      navigator.geolocation.getCurrentPosition(
        function (position) {
          const lat = position.coords.latitude.toFixed(5);
          const lon = position.coords.longitude.toFixed(5);
          statusEl.innerText = `📍 위치 확인 완료! 위도: ${lat}, 경도: ${lon}`;
          startBtn.style.display = "inline-block";
        },
        function (error) {
          statusEl.innerText = "위치 접근이 거부되었어요.";
        }
      );
    }

    function getLocation() {
      navigator.geolocation.getCurrentPosition(function (position) {
        const lat = position.coords.latitude.toFixed(5);
        const lon = position.coords.longitude.toFixed(5);
        statusEl.innerText = `📍 현재 위치: 위도 ${lat}, 경도 ${lon}`;
        startBtn.style.display = "inline-block";
      });
    }

    // 감정 질문으로 이동하는 동작
    startBtn.addEventListener("click", function () {
      alert("이제 감정 선택 페이지로 이동합니다! 🎈");
      // 여기에 실제 감정 선택 페이지 링크 연결 가능
      // location.href = "emotion.html";
    });

    checkGeolocationPermission();
  </script>
</body>
</html>
