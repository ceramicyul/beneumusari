<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>위치 권한 확인</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #fefae0;
      text-align: center;
      padding: 2rem;
    }
    #status {
      margin-top: 2rem;
      font-size: 1.5rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>우무사리 위치 확인</h1>
  <p>당신의 위치 서비스를 사용할 수 있는지 확인 중이에요.</p>
  <div id="status">⏳ 위치 서비스 확인 중...</div>

  <script>
    const statusEl = document.getElementById("status");

    // 위치 권한 확인 함수
    function checkGeolocationPermission() {
      if (!navigator.permissions || !navigator.geolocation) {
        statusEl.innerText = "❌ 이 브라우저는 위치 서비스를 지원하지 않아요.";
        return;
      }

      navigator.permissions.query({ name: "geolocation" }).then(function(result) {
        if (result.state === "granted") {
          statusEl.innerText = "✅ 위치 서비스가 이미 허용되어 있어요!";
          getLocation(); // 위치 정보 받아오기
        } else if (result.state === "prompt") {
          statusEl.innerText = "❔ 위치 서비스 사용 허가를 요청합니다.";
          requestLocation(); // 위치 요청하면서 물어봄
        } else if (result.state === "denied") {
          statusEl.innerText = "🚫 위치 서비스 사용이 차단되어 있어요. 브라우저 설정을 확인해 주세요.";
        }

        // 권한 상태가 바뀔 때도 감지
        result.onchange = () => {
          checkGeolocationPermission();
        };
      });
    }

    // 위치 요청 함수
    function requestLocation() {
      navigator.geolocation.getCurrentPosition(
        function (position) {
          const lat = position.coords.latitude.toFixed(5);
          const lon = position.coords.longitude.toFixed(5);
          statusEl.innerText = `📍 위치 허용됨! 위도: ${lat}, 경도: ${lon}`;
        },
        function (error) {
          if (error.code === error.PERMISSION_DENIED) {
            statusEl.innerText = "🙅 위치 접근이 거부되었어요.";
          } else if (error.code === error.POSITION_UNAVAILABLE) {
            statusEl.innerText = "📡 위치 정보를 사용할 수 없어요.";
          } else if (error.code === error.TIMEOUT) {
            statusEl.innerText = "⏱️ 위치 요청이 시간 초과되었어요.";
          } else {
            statusEl.innerText = "⚠️ 위치 오류가 발생했어요.";
          }
        }
      );
    }

    // 권한이 허용된 경우 위치를 불러옴
    function getLocation() {
      navigator.geolocation.getCurrentPosition(function (position) {
        const lat = position.coords.latitude.toFixed(5);
        const lon = position.coords.longitude.toFixed(5);
        statusEl.innerText = `📍 현재 위치: 위도 ${lat}, 경도 ${lon}`;
      });
    }

    // 페이지 로드시 자동 실행
    checkGeolocationPermission();
  </script>
</body>
</html>
